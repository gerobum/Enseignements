\mode<beamer>{\usetheme{Warsaw}}
\mode<beamer>{\usecolortheme{crane}}

% \usepackage{ulem}
% \usepackage[utf8x]{inputenc}
\usepackage[latin1]{inputenc}
\usepackage[OT1,T1]{fontenc}
\usepackage{default}
\usepackage{eurosym}

% \usepackage{kpfonts}
% \usepackage{fourier}
\usepackage{lmodern}

\usepackage{textcomp}
%\usepackage[francais]{babel}
\usepackage[frenchb]{babel}



% Pour écrire du code Java (début) 
\usepackage{color}       
\usepackage{listings}
\definecolor{colKeys}{rgb}{0,0,1}
\definecolor{colIdentifier}{rgb}{0,0,0}
\definecolor{colComments}{rgb}{0,0.5,0}
\definecolor{colString}{rgb}{0.6,0.1,0.1}
\lstset{%configuration de listings
float=hbp,%
basicstyle=\ttfamily\small, %
identifierstyle=\color{colIdentifier}, %
keywordstyle=\color{colKeys}\textbf, %
stringstyle=\color{colString}, %
commentstyle=\color{colComments}\textit, %
columns=flexible, %
tabsize=2, %
frame=trBL, %
frameround=tttt, %
extendedchars=true, %
showspaces=false, %
showstringspaces=false, %
%numbers=left, %
%numberstyle=\tiny, %
breaklines=true, %
breakautoindent=true, %
captionpos=b,%
xrightmargin=0cm, %
xleftmargin=0cm,
float=h
}
% Pour écrire du code Java (fin)

\setbeamertemplate{navigation symbols}{%
% \insertslidenavigationsymbol
% \insertframenavigationsymbol
% \insertsubsectionnavigationsymbol
% \insertsectionnavigationsymbol
% \insertdocnavigationsymbol
% \insertbackfindforwardnavigationsymbol
}

\usepackage{tikz}
\usetikzlibrary{calc,arrows,decorations.pathmorphing,backgrounds,positioning,shadows,fit,shapes,shapes.callouts,shapes.multipart,shapes.geometric,patterns}

\title{JUnit}
\subtitle{Correction commentée de l'exercice \og Equation \fg{}}
\date{}
\author{Yvan Maillot}

\begin{document}
% \beamertemplatetransparentcovered

% \selectlanguage{frenchb}
\lstset{language=java}

% \frame{\titlepage}

% %--------- Sommaire ---------
% \section*{Sommaire}
% \begin{frame}[plain]{Sommaire}
%   \tableofcontents[hideallsubsections]
% \end{frame}   

\begin{frame}
 \maketitle
\end{frame}


%-----------------------------
\begin{frame}[plain,fragile]{La classe \lstinline+Equation+}
\begin{lstlisting}
public class Equation {
    private int nbRacines;
    private double x1, x2;                        
    /* Résoudre l'équation axx+bx+c=0
     * @param a le coefficient de degré 2, 
     *                 un entier différent de 0
     * @param b le coefficient de degré 1
     * @param c le coefficient de degré 0
     */
    public Equation(int a, int b, int c) {     
    }

    public int getNbRacines() {return nbRacines;}
    public double getX1() {return x1;}
    public double getX2() {return x2;}  
}  
\end{lstlisting}
\end{frame}
%-----------------------------


%-----------------------------
\begin{frame}[plain,fragile]{Le test de \lstinline+Equation+}
\begin{lstlisting}    
public void testEquation() {
  System.out.println("Test équation");
  for (int i = 0; i < 100000; i++) {
    int a;
    do {
      a = random.nextInt(101) - 50;
    } while (a == 0);
    int b = random.nextInt(101) - 50;
    int c = random.nextInt(101) - 50;
    Equation e = new Equation(a, b, c);
    if (e.getNbRacines() > 0) {
      double x1 = e.getX1(), x2 = e.getX2();
      assertEquals(0.0, a * x1 * x1 + b * x1 + c, 1e-10);
      assertEquals(0.0, a * x2 * x2 + b * x2 + c, 1e-10);
    }}}
\end{lstlisting}
\end{frame}

%-----------------------------
\begin{frame}[plain,fragile]{Erratum}
\begin{lstlisting}    
public void testEquation() {
  System.out.println("Test équation");
  for (int i = 0; i < 100000; i++) {
    int a;
    do {
      a = random.nextInt(101) - 50;
    } while (a == 0);
    int b = random.nextInt(101) - 50;
    int c = random.nextInt(101) - 50;
    Equation e = new Equation(a, b, c);
// Si, par erreur, getNbRacines() retourne toujours 0, le
// test passera quelles que soient les racines trouvées !
    if (e.getNbRacines() > 0) {
      double x1 = e.getX1(), x2 = e.getX2();
      assertEquals(0.0, a * x1 * x1 + b * x1 + c, 1e-10);
      assertEquals(0.0, a * x2 * x2 + b * x2 + c, 1e-10);
    }}}
\end{lstlisting}
\end{frame}

%-----------------------------
\begin{frame}[plain,fragile]{Humanum est}
\begin{lstlisting}    
public void testEquation() {
  System.out.println("Test équation");
// Commence comme la diapo précédente 
  ...
// Il n'y a pas d'autres solutions que re-calculer le 
// discriminant pour savoir si le nombre de racines 
// calculé est juste.
    double delta = b * b - 4 * a * c;
    if (delta < 0) {
       assertEquals(0, e.getNbRacines());
    } else if (delta == 0) {
        assertEquals(1, e.getNbRacines());
    } else {
        assertEquals(2, e.getNbRacines());
    }
    if (e.getNbRacines() > 0) {
      double x1 = e.getX1(), x2 = e.getX2();
      assertEquals(0.0, a * x1 * x1 + b * x1 + c, 1e-10);
      assertEquals(0.0, a * x2 * x2 + b * x2 + c, 1e-10);
    }}}
\end{lstlisting}
\end{frame}


%-----------------------------
\begin{frame}[plain,fragile]{Le constructeur}
\begin{lstlisting}    
    public Equation(int a, int b, int c) {
        double delta = b * b - 4 * a * c;
        if (delta < 0) {
            nbRacines = 0;
        } else if (delta == 0) {
            nbRacines = 1;
// Un piège (-b/(2*a)) à l'origine d'erreurs fréquentes
            x1 = x2 = (-b*1.0) / (2 * a);
        } else {
            nbRacines = 2;
            double rdelta = Math.sqrt(delta);
// Autre erreur possible : diviser par 2 * a
            x1 = (-b - rdelta)/ (2 * a);
            x2 = (-b + rdelta)/ (2 * a);
        }
    }
\end{lstlisting}
\end{frame}
%-----------------------------
\begin{frame}[plain,fragile]{Exception possible}
\begin{lstlisting}   
  ... 
  for (int i = 0; i < 100000; i++) {
  int a;
  //do {
    a = random.nextInt(101) - 50;
  //} while (a == 0);
  ...
  try {
    Equation e = new Equation(a, b, c);
  } catch (Exception ex) {
    assertTrue(ex instanceof DataFormatException);
    assertEquals(0, a);
  }
\end{lstlisting}
\end{frame}

%-----------------------------
\begin{frame}[plain,fragile]{Lancement de l'exception}
\begin{lstlisting}   
    public Equation(int a, int b, int c) throws DataFormatException {
        if (a == 0) throw new DataFormatException();

        double delta = b * b - 4 * a * c;
        if (delta < 0) {
            nbRacines = 0;
        } else if (delta == 0) {
            nbRacines = 1;
            x1 = x2 = (-b*1.0) / (2 * a);
        } else {
            nbRacines = 2;
            double rdelta = Math.sqrt(delta);
            x1 = (-b - rdelta)/ (2 * a);
            x2 = (-b + rdelta)/ (2 * a);
        }
    }
\end{lstlisting}
\end{frame}

\end{document}


